# R01 Figure Report: RNN Analysis Rejects Local SC Computation

## Overview

This document describes the analyses and methods used to generate the R01 figure demonstrating that local SC dynamics are insufficient for competition resolution.

## Data Sources

### Recording Sessions
- **Session 08_13**: 10 E neurons, 4 I neurons, 412 trials
- **Session 08_14**: 25 E neurons, 16 I neurons, 536 trials
- **Session 08_15**: 41 E neurons, 13 I neurons, 1043 trials

Total pooled: **76 E neurons, 33 I neurons**

### Trained Models
- Full E/I-constrained RNNs trained for each session
- E-only models (I neurons unconstrained) for Panel C comparison

---

## Methods

### Model Architecture

E/I-constrained RNN with:
- Dale's Law enforced (E neurons have positive outgoing weights, I neurons have negative)
- Attention-based input embedding (14 inputs → 56-dimensional embedding)
- Learnable initial hidden state (h0)
- Softplus activation with learnable rate scaling
- Output from E neurons only

### E-Only Model Training (Panel C)

To reveal what inhibitory dynamics the network "needs" to fit E neuron data:

1. Train RNN with same architecture as full model (200 total neurons: 160 E + 40 I)
2. L_neuron loss computed only over E neurons (first n_recorded_E neurons)
3. I neurons (40 per model) remain in model (Dale's Law enforced) but are unconstrained
4. After training, extract learned I neuron PSTHs for comparison
5. Compute factor selectivity using partial eta-squared

**E-Only Model Results:**
| Session | Recorded E | Hidden E | Total I | Best Correlation |
|---------|------------|----------|---------|------------------|
| 08_13 | 10 | 150 | 40 | 0.3254 |
| 08_14 | 25 | 135 | 40 | 0.3539 |
| 08_15 | 41 | 119 | 40 | 0.3556 |

### I→E Connectivity Analysis (Panel B)

For each session's trained full E/I model:

1. Extract I→E weight submatrix: W_IE[e, i] = weight from I neuron i to E neuron e
2. Compute total inhibitory input per E neuron: `sum(|W_IE[e, :]|)`
3. Compute factor selectivity for each E neuron using multiple regression (partial eta-squared)
4. Correlate total I input with factor selectivity
5. Pool across sessions

**Expected result**: No significant correlation, supporting global (non-factor-specific) inhibition

### Input-Potent / Input-Null Subspace Decomposition (Panel D)

Following Kaufman et al. (2014) Nature Neuroscience:

1. **Define input-potent subspace**:
   - Compute trial-averaged population activity X(t) and inputs U(t)
   - Regress: X = B @ U → solve for B
   - Input-potent subspace: column space of B (orthonormalize via QR)

2. **Define input-null subspace**:
   - Orthogonal complement to input-potent
   - Represents recurrence-driven dynamics

3. **Compute factor-related variance**:
   - For each factor (reward, salience):
     - Compute condition-averaged activity (high vs low)
     - Project difference onto each subspace
     - Report proportion of variance in each subspace

**Expected result**: Input-potent dominates → factor information is input-driven, not generated by local recurrence

### Factor Selectivity Computation (Panels B, C, E)

**Partial eta-squared (Panels B, C)**:
- Multiple regression: firing_rate ~ reward + location + identity + salience
- Partial eta-squared: t²/(t² + df_residual) for each factor
- Represents proportion of variance uniquely explained

**ROC-based selectivity (Panel E)**:
- AUC for classifying trial conditions (e.g., reward vs no-reward)
- Selectivity index: 2 × (AUC - 0.5), range [-1, 1]

---

## Statistics

### Panel B: I→E Connectivity vs Factor Selectivity

| Measure | Value |
|---------|-------|
| N (E neurons pooled) | 76 |
| Reward selectivity vs I input (r) | 0.085 |
| Reward selectivity vs I input (p) | 0.465 |
| Salience selectivity vs I input (r) | -0.245 |
| Salience selectivity vs I input (p) | 0.033 |

**Interpretation**: No significant positive correlation between I→E connectivity strength and E neuron factor selectivity. The slight negative correlation with salience suggests, if anything, that more strongly inhibited E neurons are *less* salience-selective.

### Panel C: Model vs Recorded Interneuron Selectivity

| Measure | Model I | Recorded I |
|---------|---------|------------|
| N | 120 | 33 |
| Mean selectivity | 0.0125 | 0.0178 |
| KS statistic | 0.127 | - |
| p-value | 0.748 | - |
| Cohen's d | -0.24 | - |

**Interpretation**: Model I neurons (unconstrained during E-only training) develop similarly low factor selectivity as recorded putative interneurons. The non-significant KS test (p = 0.748) indicates no distributional difference. This suggests that the low selectivity of recorded interneurons is consistent with their role in local circuit dynamics rather than requiring factor-tuned inputs.

### Panel D: Subspace Variance Decomposition

| Factor | Input-Potent | Input-Null | N sessions |
|--------|--------------|------------|------------|
| Reward (goal-directed) | 0.850 ± 0.080 | 0.150 ± 0.080 | 3 |
| Salience (stimulus-driven) | 0.789 ± 0.106 | 0.211 ± 0.106 | 3 |

**Interpretation**: 85% of reward-related and 79% of salience-related variance is in the input-potent subspace, indicating that factor information is predominantly input-driven rather than generated by local recurrent dynamics.

### Panel E: Recorded Neuron ROC Selectivity

| Measure | E neurons | I neurons |
|---------|-----------|-----------|
| N | 76 | 33 |
| Mean reward selectivity | -0.027 | 0.001 |
| Mean salience selectivity | 0.000 | 0.000 |

**Note**: Low mean selectivity values may reflect heterogeneous populations with positive and negative selectivity that average out. Individual neurons show distributed selectivity patterns.

---

## Figure Caption

**Figure X. RNN analysis rejects local SC computation.**

**(A)** Architecture of E/I-constrained RNN trained on SC population recordings. Excitatory (E, blue filled) and inhibitory (I, orange open) populations are separated per Dale's Law. Inputs drive both populations; only E neurons project to output.

**(B)** Learned I→E connectivity is uncorrelated with factor selectivity of postsynaptic E units (reward: r = 0.09, p = 0.47; salience: r = -0.25, p = 0.03), inconsistent with structured lateral inhibition hypotheses. Each point represents one E neuron (n = 76 pooled across 3 sessions).

**(C)** RNNs trained to fit only E neurons (n = 120 model I neurons pooled from 3 sessions) develop I neurons with similarly low factor selectivity as recorded putative SC interneurons (n = 33, gray). Model and recorded distributions are not significantly different (KS test: D = 0.13, p = 0.75), suggesting recorded interneuron properties are consistent with local circuit constraints.

**(D)** Input-potent / input-null subspace decomposition reveals factor-related variance is predominantly input-driven (85% reward, 79% salience) rather than recurrence-driven. Bars show mean ± SEM across 3 sessions. Reference: Kaufman et al. (2014) Nat Neurosci.

**(E)** Putative SC interneurons (orange, open circles) cluster near chance on both goal-directed and stimulus-driven dimensions, contrasting with classic SC neurons (gray, filled circles) that show distributed selectivity. Dashed lines indicate chance level (selectivity = 0).

Together, these analyses demonstrate that local SC dynamics are insufficient for competition resolution.

---

## Source Data

### Data Files
- `data/rnn_export_Newton_08_13_2025_SC.mat`
- `data/rnn_export_Newton_08_14_2025_SC.mat`
- `data/rnn_export_Newton_08_15_2025_SC.mat`

### Model Checkpoints
- `results/replication/Newton_08_13_2025_SC/model_best.pt`
- `results/replication/Newton_08_14_2025_SC/model_best.pt`
- `results/final_model/model_best.pt` (Session 08_15)
- `results/e_only_model/session_08_*/model_best.pt` (E-only models)

### Panel Data
- `results/r01_figure/panel_data/panel_b_data.npz`
- `results/r01_figure/panel_data/panel_c_data.npz`
- `results/r01_figure/panel_data/panel_d_data.npz`
- `results/r01_figure/panel_data/panel_e_data.npz`

### Figure Files
- `results/r01_figure/figure_rnn_analysis.png` (300 DPI)
- `results/r01_figure/figure_rnn_analysis.pdf` (vector)

---

## References

- Kaufman MT, Churchland MM, Ryu SI, Shenoy KV (2014). Cortical activity in the null space: permitting preparation without movement. *Nature Neuroscience* 17(3):440-448.

- Song HF, Yang GR, Wang XJ (2016). Training Excitatory-Inhibitory Recurrent Neural Networks for Cognitive Tasks: A Simple and Flexible Framework. *PLOS Computational Biology* 12(2):e1004792.

---

*Report generated: 2025-01-25*
